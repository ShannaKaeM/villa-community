{# MI Card Loop Block Template #}

{# Set up the grid classes based on columns attribute #}
{% set grid_classes = 'grid gap-6' %}
{% if attributes.columns == 1 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1' %}
{% elseif attributes.columns == 2 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1 md:grid-cols-2' %}
{% elseif attributes.columns == 3 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1 md:grid-cols-2 lg:grid-cols-3' %}
{% elseif attributes.columns == 4 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1 md:grid-cols-2 lg:grid-cols-4' %}
{% endif %}

{# Set up the wrapper attributes #}
{% set wrapper_attributes = fn('get_block_wrapper_attributes', {
    'class': attributes.className
}) %}

<div {{ wrapper_attributes|raw }}>
    {% if attributes.showFilters and attributes.variant == 'property' %}
        {# Layout with filter sidebar #}
        {% set sidebar_position = attributes.filterPosition == 'left' ? 'lg:grid-cols-[300px_1fr]' : 'lg:grid-cols-[1fr_300px]' %}
        <div class="grid grid-cols-1 {{ sidebar_position }} gap-6">
            
            {% if attributes.filterPosition == 'left' %}
                {# Left sidebar #}
                <div class="d-drawer lg:d-drawer-open">
                    <input id="filter-drawer" type="checkbox" class="d-drawer-toggle" />
                    <div class="d-drawer-content flex lg:hidden mb-4">
                        <label for="filter-drawer" class="d-btn d-btn-primary d-drawer-button">Show Filters</label>
                    </div>
                    <div class="d-drawer-side min-h-[50vh] z-10">
                        <label for="filter-drawer" aria-label="close sidebar" class="d-drawer-overlay"></label>
                        <div class="d-menu bg-base-200 w-80 min-h-full p-4">
                            {% include 'blocks/mi-card-loop/filter-sidebar.twig' %}
                        </div>
                    </div>
                </div>
                
                {# Card grid #}
                <div class="{{ grid_classes }}">
                    {% include 'blocks/mi-card-loop/card-content.twig' %}
                </div>
            {% else %}
                {# Card grid #}
                <div class="{{ grid_classes }}">
                    {% include 'blocks/mi-card-loop/card-content.twig' %}
                </div>
                
                {# Right sidebar #}
                <div class="d-drawer lg:d-drawer-open">
                    <input id="filter-drawer" type="checkbox" class="d-drawer-toggle" />
                    <div class="d-drawer-content flex lg:hidden mb-4">
                        <label for="filter-drawer" class="d-btn d-btn-primary d-drawer-button">Show Filters</label>
                    </div>
                    <div class="d-drawer-side min-h-[50vh] z-10">
                        <label for="filter-drawer" aria-label="close sidebar" class="d-drawer-overlay"></label>
                        <div class="d-menu bg-base-200 w-80 min-h-full p-4">
                            {% include 'blocks/mi-card-loop/filter-sidebar.twig' %}
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    {% else %}
        {# Standard card grid #}
        <div class="{{ grid_classes }}">
            {% include 'blocks/mi-card-loop/card-content.twig' %}
        </div>
    {% endif %}
</div>