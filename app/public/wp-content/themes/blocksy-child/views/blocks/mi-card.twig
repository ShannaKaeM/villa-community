{# MI Card Block Template #}

{# Set up the grid classes based on columns attribute #}
{% set grid_classes = 'grid gap-6' %}
{% if attributes.columns == 1 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1' %}
{% elseif attributes.columns == 2 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1 md:grid-cols-2' %}
{% elseif attributes.columns == 3 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1 md:grid-cols-2 lg:grid-cols-3' %}
{% elseif attributes.columns == 4 %}
    {% set grid_classes = grid_classes ~ ' grid-cols-1 md:grid-cols-2 lg:grid-cols-4' %}
{% endif %}

{# Set up the wrapper attributes #}
{% set wrapper_attributes = fn('get_block_wrapper_attributes', {
    'class': grid_classes ~ ' ' ~ attributes.className
}) %}

<div {{ wrapper_attributes|raw }}>
    {# Handle different variants #}
    {% if attributes.variant == 'property' %}
        {% if properties|length > 0 %}
            {# Loop through properties and display cards #}
            {% for property in properties %}
                {% include 'components/card.twig' with {
                    variant: 'property',
                    title: property.title,
                    image: {
                        src: property.thumbnail ?: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_20PM.jpeg',
                        alt: property.title
                    },
                    link: {
                        url: property.permalink,
                        text: 'View Property'
                    },
                    meta: {
                        price: property.price ? '$' ~ property.price : '$500,000',
                        location: property.location ?: 'Sample Location',
                        bedrooms: property.bedrooms ?: '3',
                        bathrooms: property.bathrooms ?: '2',
                        area: property.area ? property.area ~ ' sq ft' : '2,000 sq ft'
                    }
                } %}
            {% endfor %}
        {% else %}
            {# Display sample property cards if no properties found #}
            {% set sample_properties = [
                {
                    variant: 'property',
                    title: 'Luxury Villa with Pool',
                    image: {
                        src: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_20PM.jpeg',
                        alt: 'Luxury Villa'
                    },
                    link: {
                        url: '#',
                        text: 'View Property'
                    },
                    meta: {
                        price: '$1,250,000',
                        location: 'Palm Beach, FL',
                        bedrooms: '4',
                        bathrooms: '3.5',
                        area: '3,200 sq ft'
                    }
                },
                {
                    variant: 'property',
                    title: 'Modern Beachfront Condo',
                    image: {
                        src: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_24PM (3).jpeg',
                        alt: 'Modern Condo'
                    },
                    link: {
                        url: '#',
                        text: 'View Property'
                    },
                    meta: {
                        price: '$750,000',
                        location: 'Miami Beach, FL',
                        bedrooms: '2',
                        bathrooms: '2',
                        area: '1,500 sq ft'
                    }
                },
                {
                    variant: 'property',
                    title: 'Spacious Family Home',
                    image: {
                        src: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_24PM (5).jpeg',
                        alt: 'Family Home'
                    },
                    link: {
                        url: '#',
                        text: 'View Property'
                    },
                    meta: {
                        price: '$850,000',
                        location: 'Orlando, FL',
                        bedrooms: '5',
                        bathrooms: '3',
                        area: '2,800 sq ft'
                    }
                }
            ] %}
            
            {% for property in sample_properties|slice(0, attributes.count) %}
                {% include 'components/card.twig' with property %}
            {% endfor %}
        {% endif %}
    {% elseif attributes.variant == 'business' %}
        {% if businesses|length > 0 %}
            {# Loop through businesses and display cards #}
            {% for business in businesses %}
                {% include 'components/card.twig' with {
                    variant: 'business',
                    title: business.title,
                    description: business.excerpt,
                    image: {
                        src: business.thumbnail ?: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_24PM (3).jpeg',
                        alt: business.title
                    },
                    link: {
                        url: business.permalink,
                        text: 'View Business'
                    },
                    meta: {
                        phone: business.phone ?: '(555) 123-4567',
                        email: business.email ?: 'info@example.com',
                        website: business.website ?: 'www.example.com',
                        address: business.address ?: '123 Main St, City, ST',
                        categories: business.categories ?: []
                    }
                } %}
            {% endfor %}
        {% else %}
            {# Display sample business cards if no businesses found #}
            {% set sample_businesses = [
                {
                    variant: 'business',
                    title: 'Coastal Cafe',
                    description: 'A cozy cafe with ocean views and delicious food.',
                    image: {
                        src: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_24PM (3).jpeg',
                        alt: 'Coastal Cafe'
                    },
                    link: {
                        url: '#',
                        text: 'View Business'
                    },
                    meta: {
                        phone: '(555) 123-4567',
                        email: 'info@coastalcafe.com',
                        website: 'www.coastalcafe.com',
                        address: '123 Beach Rd, Miami, FL',
                        categories: [{name: 'Restaurant', slug: 'restaurant'}]
                    }
                },
                {
                    variant: 'business',
                    title: 'Ocean View Spa',
                    description: 'Luxury spa treatments with a view of the ocean.',
                    image: {
                        src: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_20PM.jpeg',
                        alt: 'Ocean View Spa'
                    },
                    link: {
                        url: '#',
                        text: 'View Business'
                    },
                    meta: {
                        phone: '(555) 987-6543',
                        email: 'relax@oceanviewspa.com',
                        website: 'www.oceanviewspa.com',
                        address: '456 Palm Ave, Palm Beach, FL',
                        categories: [{name: 'Spa', slug: 'spa'}, {name: 'Wellness', slug: 'wellness'}]
                    }
                },
                {
                    variant: 'business',
                    title: 'Sunset Rentals',
                    description: 'Boat and water sports equipment rentals for your perfect day.',
                    image: {
                        src: theme.uri ~ '/docs/Images/Generated Image May 14, 2025 - 12_24PM (5).jpeg',
                        alt: 'Sunset Rentals'
                    },
                    link: {
                        url: '#',
                        text: 'View Business'
                    },
                    meta: {
                        phone: '(555) 456-7890',
                        email: 'info@sunsetrentals.com',
                        website: 'www.sunsetrentals.com',
                        address: '789 Harbor Dr, Key West, FL',
                        categories: [{name: 'Rentals', slug: 'rentals'}, {name: 'Recreation', slug: 'recreation'}]
                    }
                }
            ] %}
            
            {% for business in sample_businesses|slice(0, attributes.count) %}
                {% include 'components/card.twig' with business %}
            {% endfor %}
        {% endif %}
    {% else %}
        {# Generic cards for custom content #}
        {% for card in generic_cards|slice(0, attributes.columns) %}
            {% include 'components/card.twig' with {
                variant: 'generic',
                title: card.title,
                description: card.description,
                image: card.image,
                link: card.link
            } %}
        {% endfor %}
    {% endif %}
</div>
